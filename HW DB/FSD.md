<table width="1000" border="1">
<thead>
  <tr>
    <td rowspan="3"><img width="300px" src="https://github.com/vnukov-vv/AlfaCampus-SA/assets/101928718/6c8664d3-2b42-4c23-9b08-686f390ca366"></td>
    <td colspan="2" width="700"><p align="center"><b>Cтруктура БД для сервиса «Доставка заказа карт»</b></p></td>
  </tr>
  <tr>
    <td>Дата</td>
    <td>15.01.2024</td>
  </tr>
  <tr>
    <td>Версия</td>
    <td>1.1</td>
  </tr>
</thead>
</table>

## История изменений

|Дата |Описание изменения |Версия |Автор |Бизнес-заказчик |Согласование<br>бизнес-заказчика|
|:---:|:---:|:---:|:---:|:---:|:---:|
|16/01/2024|Согласованная версия документа|1.1|Внуков В.В. |Кислицын Е.В.|---|

## Контактные лица
|Подразделение	|Роль в процессе| Фамилия И.О.|
|---|---|---|
|Альфа-Кампус|СА-Кампусенок|Внуков В.В.|

# Cтруктура БД для сервиса «Доставка заказа карт».

## Оглавление
[1. Требования к Системе](#title1) <br> 
&nbsp; [1.1 Термины и определения](#title1_1) <br>
&nbsp; [1.2 Функциональные требования к Системе](#title1_2) <br>
[2. Структура БД](#title2)</br>
[3. Описание БД](#title3)</br>
&nbsp; [3.1 Таблицы БД](#title3_1) <br>
&nbsp; [3.2 Описание таблиц БД](#title3_2) <br>
<br>
[Пояснительная записка](#title4)</br>


## <a id="title1"> 1. Требования к Системе </a>
### <a id="title1_1"> 1.1. Термины и определения </a>
|Термин	|Определение|
|---|---|
|**Доставка**	|Комплекс мероприятий, осуществляемых для передачи **Карты** **Клиенту**|
|**Карта**	|Банковская карта (расчетная, кредитная) на физическом носителе выпущенная на имя конкретного **Клиента**, либо неперсонифицированная.|
|**Клиент**	|физическое лицо на имя которого в **Банке** открыт счёт и выпущена **Карта**|
|**Курьер**	|Физическое лицо осуществляющее доставку **Карты**|
|**Система**	|Комплекс программного и технического обеспечения предназначенный для поддержки бизнес-процессов **Банка**|
|**Пользователь**	|Физическое лицо имеющее доступ к **Системе** и обладающий правами на отображение и/или изменение данных|

### <a id="title1_2"> 1.2 Функциональные требования к Системе </a>

- **Курьер** должен иметь возможность авторизации в **Системе** как пользователь.
- **Курьер** должен иметь возможность просмотра в **Системе**:
    - Списка заданий на **Доставку** содержащих в т.ч. реквизиты **Карты**, **Клиента** и атрибуты **Встречи**).
- **Курьер** должен иметь возможность изменять следующие атрибуты:
    - атрибуты **Встречи** (Время, Место, Контактные данные **Клиента**)
    - статус **Доставки** (Завершена, Отменена или Неуспешна)

## <a id="title2"> 2. Структура БД **ParcelDelivery** </a>

[ParcelDelivery.drawio.xml](https://github.com/vnukov-vv/AlfaCampus-SA/blob/main/HW%20DB/ParcelDelivery.drawio.xml)

![](https://github.com/vnukov-vv/AlfaCampus-SA/blob/main/HW%20DB/ParcelDelivery.drawio.png)

## <a id="title3"> 3. Описание схемы БД **ParcelDelivery** </a>

База данных предназначена для автоматизации процессов доставки Карт с возможностью расширения до *«Доставки любых банковских продуктов»* 

### <a id="title3_1">Таблицы БД **ParcelDelivery**</a>
|№ |Имя|Описание| 
|---|---|---|
|1|pd.users|Пользователи **Системы**|
|2|pd.employees|Сотрудники **Курьеры**|
|3|pd.parcels|Заказы на **Доставку**|
|4|pd.statuses|Статусы **Доставки**|
|5|pd.subjects|Позиции включенные в **Доставку**<br>Уникальный идентификатор **Карты** или другого банковского продукта|
|6|pd.shippings|Атрибуты (адрес) **Встречи**|
|7|pd.clients|Персональные данные **Клиента**|
|8|pd.contacts|Контактные данные **Клиента** для **Доставки**|
|9|pd.products|Справочник банковских продуктов для **Доставки**|

### <a id="title3_2">Описание таблиц БД **ParcelDelivery**</a>

#### pd.users
Пользователи **Системы**
##### Колонки (2)
|№ |Имя|Тип<br>данных|Размер|Обязательное<br>(Да/Нет)|Описание|
|---|---|---|---|---|---|
|1|idUser|bigint|8|Да|Первичный ключ|
|2|Login|nchar|10|Да|Логин пользователя|
##### Ключи
|Тип|Имя ключа|Поле|Описание| 
|---|---|---|---|
|---|---|---|---|
##### Индексы
|Имя|Детали|Ключи|Описание| 
|---|---|---|---|
|---|---|---|---|

#### pd.employees
Сотрудники **Курьеры**
##### Колонки (6)
|№ |Имя|Тип<br>данных|Размер|Обязательное<br>(Да/Нет)|Описание|
|---|---|---|---|---|---|
|1|Staff_ID|---|---|Да|Первичный ключ|
|2|idUser|bigint|8|Да|Внешний ключ на анкету клиента|
|3|idDepartments|int|4|Да|Внешний ключ на отделение выдачи|
|4|Last_Name|varchar|50|Да|Фамилия|
|5|First_Name|varchar|50|Да|Имя|
|6|Phone|nchar|10|Да|Телефон|
##### Ключи
|Тип|Имя ключа|Поле|Описание| 
|---|---|---|---|
|---|---|---|---|
##### Индексы
|Имя|Детали|Ключи|Описание| 
|---|---|---|---|
|---|---|---|---|

#### pd.parcels
Заказы на **Доставку**
##### Колонки (8)
|№ |Имя|Тип<br>данных|Размер|Обязательное<br>(Да/Нет)|Описание|
|---|---|---|---|---|---|
|1|Parcel_ID|bigint|8|Да|Первичный ключ|
|2|Stuff_ID|bigint|8|Да|Внешний ключ|
|3|idOrder|bigint|8|Да|Внешний ключ|
|4|idClient|bigint|8|Да|Внешний ключ|
|5|Subj_ID|bigint|10|Да|Внешний ключ на позицию в **Доставке**|
|6|Shipping_ID|bigint|10|Да|Внешний ключ на атрибуты **Встречи**|
|7|Parcel_Status|smallint|2|Да|Внешний ключ на статус **Доставки**|
|8|Update_Date|date|10|Да|Дата последнего обновления статуса|
##### Ключи
|Тип|Имя ключа|Поле|Описание| 
|---|---|---|---|
|---|---|---|---|
##### Индексы
|Имя|Детали|Ключи|Описание| 
|---|---|---|---|
|---|---|---|---|

#### pd.statuses
Статусы **Доставки** (Справочник)
##### Колонки (2)
|№ |Имя|Тип<br>данных|Размер|Обязательное<br>(Да/Нет)|Описание|
|---|---|---|---|---|---|
|1|Status_ID|smallint|2|Да|Первичный ключ|
|2|Name|nvarchar|50|Да|Наименование статуса|
##### Ключи
|Тип|Имя ключа|Поле|Описание| 
|---|---|---|---|
|---|---|---|---|
##### Индексы
|Имя|Детали|Ключи|Описание| 
|---|---|---|---|
|---|---|---|---|

#### pd.subjects
Состав **Доставки** (позиции банковских продуктов) 
##### Колонки (3)
|№ |Имя|Тип<br>данных|Размер|Обязательное<br>(Да/Нет)|Описание|
|---|---|---|---|---|---|
|1|Subj_ID|bigint|10|Да|Первичный ключ|
|2|Product_ID|bigint|8|Да|Внешний ключ|
|2|Name|nvarchar|16|Да|PAN **Карты** или иной уникальный идентификатор в рамках банковского продукта|
##### Ключи
|Тип|Имя ключа|Поле|Описание| 
|---|---|---|---|
|---|---|---|---|
##### Индексы
|Имя|Детали|Ключи|Описание| 
|---|---|---|---|
|---|---|---|---|

#### pd.shippings
Атрибуты (адрес) **Встречи**
##### Колонки (7)
|№ |Имя|Тип<br>данных|Размер|Обязательное<br>(Да/Нет)|Описание|
|---|---|---|---|---|---|
|1|Shipping_ID|bigint|10|Да|Первичный ключ|
|2|PO_Box|nvarchar|10|Нет|Почтовый индекс|
|3|City|nvarchar|50|Да|Город|
|4|Street|nvarchar|50|Да|Улица|
|5|Building|mediumint|6|Да|Дом, Строение|
|6|Office|mediumint|4|Нет|Офис,квартира, помещение|
|7|Notes|nvarchar|255|Нет|Примечание и дополнительная информация|
##### Ключи
|Тип|Имя ключа|Поле|Описание| 
|---|---|---|---|
|---|---|---|---|
##### Индексы
|Имя|Детали|Ключи|Описание| 
|---|---|---|---|
|---|---|---|---|

#### pd.clients
Персональные данные **Клиента**
##### Колонки (5)
|№ |Имя|Тип<br>данных|Размер|Обязательное<br>(Да/Нет)|Описание|
|---|---|---|---|---|---|
|1|idClient|bigint|8|Да|Внешний ключ|
|2|Surname|nvarchar|50|Да|Внешний ключ|
|3|firstName|nvarchar|50|Да|Внешний ключ|
|4|birthday|date|10|Нет|Дата рождения|
|5|Passport_Num|nvarchar|12|Нет|Номер паспорта или иного документа удостоверяющего личность|
##### Ключи
|Тип|Имя ключа|Поле|Описание| 
|---|---|---|---|
|---|---|---|---|
##### Индексы
|Имя|Детали|Ключи|Описание| 
|---|---|---|---|
|---|---|---|---|

#### pd.contacts
Контактные данные **Клиента** для **Доставки**
##### Колонки (3)
|№ |Имя|Тип<br>данных|Размер|Обязательное<br>(Да/Нет)|Описание|
|---|---|---|---|---|---|
|1|Parcel_ID|bigint|8|Да|Внешний ключ|
|2|Phone|nchar|10|Да|Телефон основной|
|3|Phone2|nchar|10|Нет|Телефон дополнительный|
##### Ключи
|Тип|Имя ключа|Поле|Описание| 
|---|---|---|---|
|---|---|---|---|
##### Индексы
|Имя|Детали|Ключи|Описание| 
|---|---|---|---|
|---|---|---|---|

#### pd.products
Банковские продуктов для **Доставки** (Справочник)
##### Колонки (3)
|№ |Имя|Тип<br>данных|Размер|Обязательное<br>(Да/Нет)|Описание|
|---|---|---|---|---|---|
|1|Product_ID|int|8|Да|Первичный ключ|
|2|Type|int|8|Да|Тип банковского продукта. Внешний ключ(опционально)|
|3|Name|nvarchar|50|Да|Наименование банковского продукта. Внешний ключ(опционально)|
##### Ключи
|Тип|Имя ключа|Поле|Описание| 
|---|---|---|---|
|---|---|---|---|
##### Индексы
|Имя|Детали|Ключи|Описание| 
|---|---|---|---|
|---|---|---|---|

## <a id="title4"> Пояснительная записка </a>

При проектировании я исходил из того, что Сервис будет интегрироваться с уже существующими,
когда часть необходимых данных для отображения берется из других БД или же ссылается на них (см. **PlasticOrder**). Такие атрибуты выделены красным цветом на схеме. 

В любом случае **Доставка** привязывается к заказу **Карты** при этом для курьерской доставки выделяется отдельный **idDepartment** (ID отделения выдачи карты).

В самом упрощенном варианте **Система** может работать непосредственно с БД **PlasticOrder**. Для этого в БД необходимо добавить две таблицы **Shippings** (Адрес курьерской доставки) и **Сontacts** (Контактные данные) т.к. в "анкете" и "заказе" БД **PlasticOrder** эти атрибуты отсутствуют. **Сontacts** выносим в отдельную таблицу т.к. они могут не совпадать с указанными в Анкете **Клиента** (временный телефон **Клиента** или телефон места его временного пребывания).

Чтобы иметь возможность группировать разные заказы (например две разных карты) в одну доставку, добавлена отдельная сущность **Parcel** ("Посылка").

**Users** и **Employees** разнесены в т.ч. в целях упрощенного администрирования. Для ограничения доступа достаточно просто удалить строку в **Users**. При этом информация о **Курьере** останется в **Employees**, равно как не будут затронуты остальные данные БД.

Для отображения состава заказа в целях его однозначной идентификации (в нашем случае это должен быть уникальный атрибут **Name** - PAN **Карты**) добавлена таблица **Subjects**.

Расширение функциональности **Cистемы** до возможности *«Доставки любых банковских продуктов»* решается добавлением в схему таблицы **Products**, а в таблицу **Subjects** атрибута **Product_ID**. Новые продукта могут добавляться в этот справочник или импортироваться из существующего, а в качестве значения атрибута **idOrder** использовать аналогичный идентификатор из БД заказа банковского продукта.  






